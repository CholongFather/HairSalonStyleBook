<div class="search-bar">
    <div class="search-input-wrapper">
        <i class="bi bi-search search-icon"></i>
        <input type="text"
               class="form-control search-input"
               placeholder="스타일 또는 #해시태그 검색"
               value="@SearchText"
               @oninput="OnInput" />
        @if (!string.IsNullOrEmpty(SearchText))
        {
            <button class="search-clear" @onclick="ClearSearch">
                <i class="bi bi-x"></i>
            </button>
        }
    </div>
</div>

@code {
    [Parameter] public string SearchText { get; set; } = "";
    [Parameter] public EventCallback<string> OnSearch { get; set; }

    private CancellationTokenSource? _debounceCtx;

    private async Task OnInput(ChangeEventArgs e)
    {
        SearchText = e.Value?.ToString() ?? "";

        // 300ms 디바운스
        _debounceCtx?.Cancel();
        _debounceCtx = new CancellationTokenSource();
        var token = _debounceCtx.Token;
        try
        {
            await Task.Delay(300, token);
            if (!token.IsCancellationRequested)
                await OnSearch.InvokeAsync(SearchText);
        }
        catch (TaskCanceledException) { }
    }

    private async Task ClearSearch()
    {
        _debounceCtx?.Cancel();
        SearchText = "";
        await OnSearch.InvokeAsync("");
    }
}

<style>
    .search-bar {
        max-width: 420px;
        margin: 0 auto;
        padding: 0.3rem 1rem 1rem;
    }

    .search-input-wrapper {
        position: relative;
    }

    .search-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--salon-gray);
        font-size: 0.8rem;
        transition: color 0.3s;
    }

    .search-input-wrapper:focus-within .search-icon {
        color: var(--salon-green);
    }

    .search-input {
        border: 1px solid var(--salon-light-gray);
        border-radius: 24px;
        padding: 0.55rem 2.2rem 0.55rem 2.4rem;
        font-family: var(--font-serif);
        font-size: 0.83rem;
        background: var(--salon-white);
        transition: all 0.3s ease;
    }

    .search-input:focus {
        border-color: var(--salon-green);
        box-shadow: 0 0 0 3px rgba(123, 163, 131, 0.1), 0 2px 8px rgba(123, 163, 131, 0.08);
    }

    .search-input::placeholder {
        color: var(--salon-light-gray);
        font-style: italic;
    }

    .search-clear {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--salon-light-gray);
        border: none;
        color: var(--salon-white);
        cursor: pointer;
        padding: 0;
        font-size: 0.75rem;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
    }

    .search-clear:hover {
        background: var(--salon-gray);
    }

    /* 태블릿 반응형 */
    @@media (min-width: 768px) {
        .search-bar {
            max-width: 500px;
        }

        .search-input {
            font-size: 0.95rem;
            padding: 0.65rem 2.5rem 0.65rem 2.6rem;
        }

        .search-icon {
            font-size: 0.9rem;
        }

        .search-clear {
            width: 24px;
            height: 24px;
            font-size: 0.85rem;
        }
    }
</style>
