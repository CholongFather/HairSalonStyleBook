@inherits LayoutComponentBase
@inject NavigationManager Nav
@implements IDisposable

<div class="salon-app">
    <Header />
    <RibbonDivider />
    <main class="salon-content">
        <div class="page-flip-container">
            <div class="page-transition @_animClass">
                @Body
            </div>
        </div>
    </main>
    <Footer />
</div>

@code {
    private string _animClass = "page-enter";

    protected override void OnInitialized()
    {
        Nav.LocationChanged += OnLocationChanged;
    }

    private async void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        // 나가는 애니메이션
        _animClass = "page-exit";
        await InvokeAsync(StateHasChanged);

        // 짧은 딜레이 후 들어오는 애니메이션
        await Task.Delay(300);
        _animClass = "page-enter";
        await InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Nav.LocationChanged -= OnLocationChanged;
    }
}

<style>
    .page-flip-container {
        perspective: 1200px;
        overflow: hidden;
    }

    .page-transition {
        animation-fill-mode: both;
        animation-timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
        transform-origin: left center;
        position: relative;
    }

    /* 페이지 들어옴 - 책장 넘기듯 오른쪽에서 펼침 */
    .page-enter {
        animation-name: pageFlipIn;
        animation-duration: 0.5s;
    }

    /* 페이지 나감 - 왼쪽으로 접힘 */
    .page-exit {
        animation-name: pageFlipOut;
        animation-duration: 0.3s;
    }

    @@keyframes pageFlipIn {
        0% {
            opacity: 0;
            transform: rotateY(-45deg) scale(0.95);
            box-shadow: -20px 0 40px rgba(0, 0, 0, 0.15);
        }
        40% {
            opacity: 1;
        }
        100% {
            opacity: 1;
            transform: rotateY(0deg) scale(1);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0);
        }
    }

    @@keyframes pageFlipOut {
        0% {
            opacity: 1;
            transform: rotateY(0deg) scale(1);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0);
        }
        100% {
            opacity: 0;
            transform: rotateY(20deg) scale(0.95);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1);
        }
    }
</style>
